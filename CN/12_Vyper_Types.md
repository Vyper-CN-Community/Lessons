# 理解 Vyper 中的基本数据类型 (v0.4.0)

欢迎学习这节关于 Vyper 基本数据类型的课程。Vyper 是一种用于以太坊虚拟机 (EVM) 的 Python 风格智能合约语言。理解类型至关重要，因为它们定义了你的智能合约变量可以持有哪种数据以及该数据如何表现。我们将在 Vyper 0.4.0 版本的背景下，通过构建一个简单的“喜爱事物列表”合约的相关示例来探索这些概念。

## 为什么我们需要类型？

智能合约在区块链上存储和操作各种信息——想一想数字、真/假状态、账户地址等等。像许多编程语言一样，Vyper 要求你明确每个变量将存储的数据类型。这确保了操作被正确执行，并通过定义允许的值类型来帮助防止错误。

## Vyper 中的静态类型

Vyper 是一门静态类型语言。这意味着每个变量的数据类型必须在代码执行前（即编译时）就被编译器知晓。你在声明变量时声明其类型，并且该类型通常不能改变。这与动态类型语言（类型在执行期间检查）形成对比。静态类型有助于在开发过程的早期捕获错误。

## 声明变量

在 Vyper 中声明变量的基本语法直截了当：
你指定想要给变量起的名字，后跟一个冒号 (`:`)，然后是代表数据类型的关键字。

```vyper
<variable_name>: <type>
```

## 值类型 (Value Types)

本课我们重点关注的主要是**值类型**。这些是基础数据类型，变量直接包含其数据。当你将值类型传递给函数或赋值给另一个变量时，会制作该值的一个副本。

## 存储变量与初始化 (Vyper v0.4.0 规则)

在合约文件顶层（任何函数之外）声明的变量称为**存储变量 (storage variables)**。它们的值作为合约状态的一部分持久存储在区块链上。

Vyper 0.4.0 版本（本示例中使用的版本）的一个关键点是，**存储变量不能在声明的那一行直接初始化赋值**。尝试这样做（例如，`my_var: uint256 = 10`）将导致编译时的 `VariableDeclarationException` 错误。存储变量会自动根据其类型获得一个默认的“零”值（例如，数字类型为 `0`，布尔型为 `False`，地址型为零地址）。必须在稍后赋值，通常是在函数内部（如构造函数或其他改变状态的函数，将在别处介绍）。

```vyper
# 在 Vyper v0.4.0 中无效（对于存储变量）
# my_var: uint256 = 10 
```

## 常见的 Vyper 基本类型

### 1. 布尔型 (bool)

```vyper
bool
```
*   **概念**：表示逻辑状态，真 (`True`) 或假 (`False`)。
*   **关键字**：`bool`
*   **可能的值**：`True` 或 `False`（注意：区分大小写）。
*   **声明示例**：
    ```vyper
    # 存储用户是否已指定喜爱数字
    has_favorite_number: bool 
    # (记住：对于存储变量，has_favorite_number: bool = False 在 Vyper 0.4.0 中会导致错误)。
    ```

### 2. 无符号整数 (uintN)

```vyper
uintN
```
*   **概念**：表示非负整数 (0, 1, 2, ...)。`N` 指定用于存储数字的位数，决定了其最大值（例如 `uint8`, `uint16`, `uint256`）。`uint256` 在以太坊中非常常见，用于表示代币余额、计数器等。
*   **关键字示例**：`uint256`
*   **声明示例**：
    ```vyper
    # 存储用户的喜爱数字（非负）
    my_favorite_number: uint256
    ```
*   **注意**：“无符号”意味着它不能持有负值。256 与比特大小有关；理解比特和字节有帮助，但对于入门来说不是必需的。

### 3. 有符号整数 (intN)

```vyper
intN
```
*   **概念**：表示可以是正数、负数或零的整数。类似于 `uintN`，`N` 指定位数（例如 `int128`, `int256`）。
*   **关键字示例**：`int256`
*   **声明示例**：
    ```vyper
    # 存储一个可能是负数的数字
    some_signed_value: int256 # (如果需要有符号数字的例子)
    ```
*   **注意**：与 `uintN` 的关键区别在于存储负值的能力。

### 4. 地址 (address)

```vyper
address
```
*   **概念**：表示一个以太坊地址。这些是 20 字节（160 位）的值，通常以 `0x` 开头的十六进制格式显示。用于存储用户账户（外部拥有账户）或其他智能合约的地址。
*   **关键字**：`address`
*   **声明示例**：
    ```vyper
    # 存储喜爱的人或合约的地址
    my_address: address
    ```
*   **注意**：你可能会从像 MetaMask 这样的钱包或与其他合约的交互中获取地址。同样，v0.4.0 中禁止对存储变量进行 `my_address: address = 0x...` 这样的直接初始化。

### 5. 小数 (decimal)

```vyper
decimal
```
*   **概念**：表示定点小数。此类型对于金融计算或需要分数精度且希望避免某些其他语言中浮点运算陷阱的情况非常有用。
*   **关键字**：`decimal`
*   **声明示例（已注释）**：
    ```vyper
    # 存储一个小数值（在 v0.4.0 中需要编译器标志）
    # my_decimal: decimal
    ```
*   **重要提示 (Vyper v0.4.0)**：使用 `decimal` 类型需要在编译时显式启用。你需要向 Vyper 编译器传递 `--enable-decimals` 标志。由于这需要特定设置，我们注释掉了示例声明。

### 6. 固定大小字节数组 (bytesN)

```vyper
bytesN
```
*   **概念**：表示字节的固定序列。`N` 指定确切的字节数（例如 `bytes1`, `bytes8`, `bytes32`）。对于处理原始字节数据、加密哈希（如 Keccak256）或其他固定长度的二进制数据很有用。
*   **关键字示例**：`bytes32`（常用于哈希）
*   **声明示例**：
    ```vyper
    # 存储一个固定大小的 32 字节值，如哈希
    my_bytes: bytes32
    ```
*   **注意**：`bytesN` 处理原始字节数据，将在关于字符串和哈希的讨论中进一步探讨。

## Vyper 文档：你最好的朋友

官方 Vyper 文档是所有类型和语言特性的权威资源。你可以在 "Types" 部分下找到详细信息：
*   **Vyper 文档**: `docs.vyperlang.org`

导航到侧边栏的 "Types" 部分将显示完整列表，包括此处提到的以及更高级的类型。

## 文档中提到的其他类型

在探索文档时，你会注意到这里没有详细介绍的其他类型，例如：
*   **字符串 (String[N])**：固定大小的字符字符串。
*   **标志 (Flag)**：用于定义枚举类型。
*   **引用类型 (Reference Types)**：更复杂的类型，如固定大小列表 (`Type[N]`)、动态数组 (`DynArray[Type, N]`)、结构体 (`Struct`) 和映射 (`Mapping`)，它们存储数据的方式与值类型不同（我们将在后续课程中介绍）。

## 示例合约结构（仅声明）

基于我们的讨论，“喜爱事物列表”合约在 Vyper 0.4.0 中的顶层声明可能如下所示：

```vyper
# version 0.4.0

"""
@title Favorites List
@license MIT
"""

has_favorite_number: bool
my_favorite_number: uint256
my_address: address
# ... 其他声明
```

本课涵盖了用于在 Vyper 智能合约中存储状态的基本构建块——基本数据类型，重点强调了声明语法以及适用于 Vyper 0.4.0 版本的特定规则。
